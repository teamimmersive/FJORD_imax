<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>MGA MAGICAL 10 YEARS ANNIVERSARY LIVE FJORD ON SCREENÔΩúIMAX ‰∏äÊò†Êò†ÁîªÈ§®„É™„Çπ„Éà</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f5f7;
      --card: #ffffff;
      --accent: #0056b3;
      --border: #e0e0e0;
      --text-main: #222222;
      --text-sub: #666666;
      --shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 10px 8px 20px;
      background: var(--bg);
      color: var(--text-main);
      line-height: 1.5;
      font-size: 14px;
    }

    .container {
      max-width: 960px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.25rem;
      margin: 0 0 0.2rem;
    }

    .subtitle {
      margin: 0 0 0.7rem;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--text-sub);
    }

    .notice-box {
      background: #fff8e1;
      padding: 8px 12px;
      border-left: 4px solid #ffb300;
      border-radius: 6px;
      font-size: 0.8rem;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .notice-box a {
      color: var(--accent);
      text-decoration: none;
      font-weight: bold;
    }

    .notice-box a:hover {
      text-decoration: underline;
    }

    .status {
      font-size: 0.7rem;
      color: var(--text-sub);
      margin-bottom: 6px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px 10px;
      align-items: center;
      margin-bottom: 8px;
    }

    .tabs {
      display: inline-flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .tab-btn {
      border: 1px solid var(--border);
      background: #ffffff;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      cursor: pointer;
      white-space: nowrap;
      color: var(--text-sub);
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }

    .tab-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #ffffff;
    }

    .pref-filter {
      margin-left: auto;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
    }

    .pref-filter label {
      color: var(--text-sub);
    }

    .pref-filter select {
      padding: 3px 8px;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 0.78rem;
      background: #ffffff;
    }

    .cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .card {
      background: var(--card);
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      width: 100%;
      overflow: hidden;
    }

    .card-imax-top {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: nowrap;
    }

    .chip-imax {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 8px;
      background: var(--accent);
      color: #fff;
      font-size: 0.75rem;
      font-weight: 600;
      flex-shrink: 0;
      white-space: nowrap;
    }

    .imax-number {
      font-size: 0.75rem;
      color: var(--text-sub);
      flex-shrink: 0;
      white-space: nowrap;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 600;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .card-pref {
      font-size: 0.75rem;
      color: #777;
      padding: 2px 6px;
      background: #f3f3f3;
      border-radius: 6px;
      width: fit-content;
    }

    .card-body {
      font-size: 0.76rem;
      color: var(--text-sub);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .card-label {
      font-size: 0.7rem;
      color: #999999;
      margin-right: 4px;
      flex-shrink: 0;
    }

    .card-row-inline {
      display: flex;
      flex-wrap: nowrap;
      gap: 4px;
      align-items: center;
      max-width: 100%;
      overflow: hidden;
    }

    .address-text {
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    a {
      color: var(--accent);
      text-decoration: none;
      font-size: 0.76rem;
    }

    a:hover {
      text-decoration: underline;
    }

    @media (min-width: 720px) {
      .cards {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (min-width: 980px) {
      .cards {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    @media (max-width: 600px) {
      body { padding: 8px 6px 18px; }
      h1 { font-size: 1.15rem; }
      .subtitle { font-size: 0.8rem; }

      .controls {
        flex-direction: column;
        align-items: flex-start;
      }

      .pref-filter {
        margin-left: 0;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>MGA MAGICAL 10 YEARS ANNIVERSARY LIVE FJORD ON SCREEN</h1>
    <p class="subtitle">IMAX ‰∏äÊò†Êò†ÁîªÈ§®„É™„Çπ„Éà</p>

    <!-- üî• ËøΩÂä†ÈÉ®ÂàÜ„Åì„Åì„Åã„Çâ -->
    <div class="notice-box">
      IMAXÁâà„Å´„ÅØËøΩÂä†ÊñôÈáë„Åå„Åã„Åã„ÇãÂ†¥Âêà„Åå„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ<br>
      Research by <a href="https://x.com/immersivetoyama?s=21&t=wwlJ0ehzK3cZI6Zmqu-bCA" target="_blank">Á´ã‰ΩìÈü≥ÈüøÊôÆÂèäÂßîÂì°‰ºö</a>
    </div>
    <!-- üî• ËøΩÂä†ÈÉ®ÂàÜ„Åì„Åì„Åæ„Åß -->

    <div class="status" id="status">Ë™≠„ÅøËæº„Åø‰∏≠...</div>

    <div class="controls">
      <div class="tabs" id="tabs"></div>

      <div class="pref-filter">
        <label for="prefSelect">ÈÉΩÈÅìÂ∫úÁúå:</label>
        <select id="prefSelect">
          <option value="ALL">„Åô„Åπ„Å¶</option>
        </select>
      </div>
    </div>

    <div class="cards" id="cards"></div>
  </div>

  <script>
    const SHEET_TSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vShtDnZUCsyJKxq1mUB8Hgid98ngAWYAcgEwhCg2MaV3cqbmyRsEsbr2eyZ8XFdyW00ZdsB2BkJhVuC/pub?gid=157320113&single=true&output=tsv";

    const statusEl = document.getElementById("status");
    const tabsEl = document.getElementById("tabs");
    const cardsEl = document.getElementById("cards");
    const prefSelectEl = document.getElementById("prefSelect");

    let allRows = [];
    let currentTabFilter = "ALL";
    let currentPrefFilter = "ALL";

    function parseTSV(text) {
      return text.trim().split(/\r?\n/).map((l) => l.split("\t"));
    }

    function detectColumnIndex(header, name, fallbackIndex) {
      const idx = header.indexOf(name);
      return idx !== -1 ? idx : fallbackIndex;
    }

    /* -------------------------
       „Çø„Éñ‰ΩúÊàêÔºà„Åô„Åπ„Å¶ / IMAXÔºâ
    ---------------------------*/
    function createTabs() {
      const defs = [
        { key: "ALL", label: "„Åô„Åπ„Å¶" },
        { key: "IMAX-YES", label: "IMAX" },
      ];
      tabsEl.innerHTML = "";

      defs.forEach((d, i) => {
        const btn = document.createElement("button");
        btn.textContent = d.label;
        btn.className = "tab-btn" + (i === 0 ? " active" : "");
        btn.dataset.filter = d.key;
        tabsEl.appendChild(btn);
      });

      tabsEl.addEventListener("click", (e) => {
        const btn = e.target.closest(".tab-btn");
        if (!btn) return;

        document.querySelectorAll(".tab-btn").forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        currentTabFilter = btn.dataset.filter;
        renderCards();
      });
    }

    /* -------------------------
       ÈÉΩÈÅìÂ∫úÁúå„É™„Çπ„ÉàÔºàÂåó ‚Üí ÂçóÔºâ
    ---------------------------*/
    function createPrefOptions() {
      const PREF_ORDER = [
        "ÂåóÊµ∑ÈÅì",
        "ÈùíÊ£Æ", "Â≤©Êâã", "ÂÆÆÂüé", "ÁßãÁî∞", "Â±±ÂΩ¢", "Á¶èÂ≥∂",
        "Ëå®Âüé", "Ê†ÉÊú®", "Áæ§È¶¨", "ÂüºÁéâ", "ÂçÉËëâ", "Êù±‰∫¨", "Á•ûÂ•àÂ∑ù",
        "Êñ∞ÊΩü", "ÂØåÂ±±", "Áü≥Â∑ù", "Á¶è‰∫ï",
        "Â±±Ê¢®", "Èï∑Èáé",
        "Â≤êÈòú", "ÈùôÂ≤°", "ÊÑõÁü•", "‰∏âÈáç",
        "ÊªãË≥Ä", "‰∫¨ÈÉΩ", "Â§ßÈò™", "ÂÖµÂ∫´", "Â•àËâØ", "ÂíåÊ≠åÂ±±",
        "È≥•Âèñ", "Â≥∂Ê†π", "Â≤°Â±±", "Â∫ÉÂ≥∂", "Â±±Âè£",
        "Âæ≥Â≥∂", "È¶ôÂ∑ù", "ÊÑõÂ™õ", "È´òÁü•",
        "Á¶èÂ≤°", "‰ΩêË≥Ä", "Èï∑Â¥é", "ÁÜäÊú¨", "Â§ßÂàÜ", "ÂÆÆÂ¥é", "ÈπøÂÖêÂ≥∂",
        "Ê≤ñÁ∏Ñ"
      ];

      const existing = [...new Set(allRows.map(r => r.prefecture))];
      const sorted = PREF_ORDER.filter(p => existing.includes(p));

      sorted.forEach((pref) => {
        const opt = document.createElement("option");
        opt.value = pref;
        opt.textContent = pref;
        prefSelectEl.appendChild(opt);
      });

      prefSelectEl.addEventListener("change", () => {
        currentPrefFilter = prefSelectEl.value;
        renderCards();
      });
    }

    /* -------------------------
       „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®
    ---------------------------*/
    function applyFilters() {
      let rows = allRows.slice();

      if (currentTabFilter === "IMAX-YES") {
        rows = rows.filter((r) => r.imaxAvailable);
      }

      if (currentPrefFilter !== "ALL") {
        rows = rows.filter((r) => r.prefecture === currentPrefFilter);
      }

      return rows;
    }

    /* -------------------------
       „Ç´„Éº„ÉâÊèèÁîª
    ---------------------------*/
    function renderCards() {
      cardsEl.innerHTML = "";
      const rows = applyFilters();

      rows.forEach((row) => {
        const card = document.createElement("div");
        card.className = "card";

        if (row.imaxAvailable) {
          const top = document.createElement("div");
          top.className = "card-imax-top";

          const chip = document.createElement("span");
          chip.className = "chip-imax";
          chip.textContent = "IMAX";
          top.appendChild(chip);

          const text = row.imaxRaw.trim();
          if (text !== "IMAX" && text !== "-") {
            const num = document.createElement("span");
            num.className = "imax-number";
            num.textContent = /^\d+$/.test(text) ? `No.${text}` : text;
            top.appendChild(num);
          }

          card.appendChild(top);
        }

        const title = document.createElement("div");
        title.className = "card-title";
        title.textContent = row.name;
        card.appendChild(title);

        const pref = document.createElement("div");
        pref.className = "card-pref";
        pref.textContent = row.prefecture;
        card.appendChild(pref);

        const body = document.createElement("div");
        body.className = "card-body";

        if (row.address) {
          const a = document.createElement("div");
          a.className = "card-row-inline";
          a.innerHTML = `<span class="card-label">‰ΩèÊâÄ</span><span class="address-text">${row.address}</span>`;
          body.appendChild(a);
        }

        if (row.url) {
          const u = document.createElement("div");
          u.className = "card-row-inline";
          u.innerHTML = `<span class="card-label">ÂÖ¨Âºè</span><a href="${row.url}" target="_blank">Web„Çµ„Ç§„Éà</a>`;
          body.appendChild(u);
        }

        card.appendChild(body);
        cardsEl.appendChild(card);
      });

      let label = currentTabFilter === "IMAX-YES" ? "IMAX" : "„Åô„Åπ„Å¶";
      if (currentPrefFilter !== "ALL") label += ` / ${currentPrefFilter}`;
      statusEl.textContent = `Ë°®Á§∫‰∏≠: ${label}Ôºà${rows.length}È§®Ôºâ`;
    }

    /* -------------------------
       ÂàùÊúüÂåñ
    ---------------------------*/
    async function init() {
      try {
        statusEl.textContent = "Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶";

        const res = await fetch(SHEET_TSV_URL);
        const text = await res.text();
        const rows = parseTSV(text);

        const header = rows[0];
        const data = rows.slice(1).filter(r => r.some(c => c.trim() !== ""));

        const prefIndex = detectColumnIndex(header, "ÈÉΩÈÅìÂ∫úÁúå", 0);
        const nameIndex = detectColumnIndex(header, "ÂäáÂ†¥Âêç", 1);
        const urlIndex  = detectColumnIndex(header, "URL", 2);
        const addrIndex = detectColumnIndex(header, "‰ΩèÊâÄ", 3);
        const imaxIndex = detectColumnIndex(header, "IMAX", 4); // EÂàó

        allRows = data.map(cols => {
          const imaxRaw = (cols[imaxIndex] || "").trim();
          return {
            prefecture: (cols[prefIndex] || "").trim(),
            name:       (cols[nameIndex] || "").trim(),
            url:        (cols[urlIndex]  || "").trim(),
            address:    (cols[addrIndex] || "").trim(),
            imaxRaw,
            imaxAvailable: imaxRaw !== "" && imaxRaw !== "-",
          };
        });

        createTabs();
        createPrefOptions();
        renderCards();
      } catch (err) {
        statusEl.textContent = "„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü";
        console.error(err);
      }
    }

    init();
  </script>
</body>
</html>
